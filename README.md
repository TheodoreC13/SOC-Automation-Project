# SOC Automation Home Lab README
## Overview
This project automates the detection and response workflow in a Security Operations Center (SOC) environment. It leverages Wazuh for threat detection on a Windows 10 virtual machine (VM) and integrates Sysmon for enhanced logging. The setup includes running the Wazuh dashboard and TheHive on DigitalOcean droplets, with Shuffler.io orchestrating the workflow. Detections are sent to VirusTotal for analysis, and alerts are managed in TheHive, with notifications sent to analysts via email.

## Prerequisites
* Windows 10 VM: Set up a Windows 10 virtual machine.
* Wazuh: Install Wazuh on the VM for threat detection.
* Sysmon: Install Sysmon to provide detailed logging of system events.
* Shuffler.io Account: Create an account on Shuffler.io to manage automation workflows.
* VirusTotal API Key: Sign up for VirusTotal and obtain an API key for file and URL analysis.
* TheHive: Set up TheHive for incident management and alerting.
* DigitalOcean Account: Create droplets for hosting the Wazuh dashboard and TheHive.

## Installation

### Install Wazuh:
* Follow the Wazuh installation guide for Windows to set up the agent and manager.
* Ensure Wazuh is properly configured to receive events from Sysmon.

### Install Sysmon:
* Download Sysmon from the Sysinternals Suite.
* Configure Sysmon with a suitable configuration file to log relevant events, and ensure it forwards logs to Wazuh.

### Set Up DigitalOcean Droplets:
* Create two droplets: one for the Wazuh dashboard and another for TheHive.
* Follow the respective installation guides to set up Wazuh and TheHive on the droplets.

### Set Up Shuffler.io:
* Log in to Shuffler.io and create a new workflow to handle incoming alerts from Wazuh.

### Configure VirusTotal:
* Add your VirusTotal API key in your Shuffler workflow settings.

### Integrate TheHive:
* Configure TheHive's API endpoint and authentication within the Shuffler workflow to send alerts.

## Configuration
### Wazuh Configuration
* Ensure your Wazuh agent is configured to monitor relevant logs, including those generated by Sysmon.
* Set up custom rules in Wazuh if necessary to capture specific events of interest.

### Sysmon Configuration
* Use a recommended Sysmon configuration file to capture critical events. Example Sysmon Config.
* Verify that Sysmon is logging events and sending them to Wazuh.

### Shuffler.io Workflow
Create a new workflow with the following steps:
* Trigger: Receive alerts from Wazuh.
* Action 1: Send file/URL to VirusTotal for analysis.
* Action 2: Parse VirusTotal results.
* Action 3: Create an incident in TheHive with the parsed data.
* Action 4: Send email notifications to analysts.

### TheHive Configuration
* Define incident templates as needed.
* Configure email notifications to ensure timely alerts for analysts.

## Workflow Overview
Detection: Sysmon logs events, which are ingested by Wazuh, generating alerts for suspicious activities.
Integration: The alert is sent to Shuffler.io, triggering the automated workflow.
Analysis: The workflow sends the relevant file or URL to VirusTotal for scanning.
Incident Creation: Shuffler.io receives the analysis results and creates an incident in TheHive.
Notification: Analysts are notified via email about the new incident.

Usage

Once everything is configured:

    Monitor Wazuh for alerts generated from Sysmon logs.
    Upon detection, the automated workflow will take over.
    Analysts can review alerts in TheHive and respond as needed.

Troubleshooting

    Wazuh Not Detecting Events: Check log configurations and ensure the Wazuh agent is running properly.
    Sysmon Not Logging: Verify Sysmon installation and configuration to ensure it is capturing events correctly.
    Shuffler.io Workflow Fails: Review the workflow configuration for any errors in API calls or steps.
    TheHive Not Receiving Alerts: Verify TheHive API configuration and check network connectivity.

## Contributing
This project is a proof of knowledge / proof of concept. No contributions are nessessary. 

## Configuration Files

    Wazuh Configuration: See wazuh-agent.conf for my specific agent settings.
    Sysmon Configuration: Review the Sysmon config in sysmon-config.xml.
    Shuffler Workflow: The Shuffler workflow is detailed in shuffler-workflow.json.
    TheHive Configuration: Review my TheHive settings in thehive-config.json.

## Screenshots
